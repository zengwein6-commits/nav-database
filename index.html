<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的导航站</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --text-primary: #333333;
      --text-secondary: #666666;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --border: #e5e5e5;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent: #60a5fa;
      --accent-hover: #3b82f6;
      --border: #404040;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 40px 0;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Search Bar */
    .search-container {
      max-width: 600px;
      margin: 0 auto 30px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      font-size: 1rem;
      border: 2px solid var(--border);
      border-radius: 50px;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      outline: none;
      transition: border-color 0.3s;
    }

    .search-input:focus {
      border-color: var(--accent);
    }

    .search-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-secondary);
      border: 2px solid var(--border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: var(--text-primary);
      transition: all 0.3s;
    }

    .theme-toggle:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Category Tabs */
    .categories {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .category-tab {
      padding: 10px 25px;
      border: 2px solid var(--border);
      border-radius: 50px;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.95rem;
    }

    .category-tab:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .category-tab.active {
      background-color: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Links Grid */
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .link-card {
      background-color: var(--bg-secondary);
      border-radius: 12px;
      padding: 20px;
      text-decoration: none;
      color: var(--text-primary);
      transition: all 0.3s;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .link-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow);
      border-color: var(--accent);
    }

    .link-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background-color: var(--bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .link-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .link-url {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 10px;
      word-break: break-all;
    }

    .link-description {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Error */
    .error {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-top: 40px;
      border-top: 1px solid var(--border);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }

      .links-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 15px;
      }

      .search-input {
        padding: 12px 40px 12px 15px;
        font-size: 0.95rem;
      }

      .theme-toggle {
        width: 45px;
        height: 45px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle" title="切换主题">
    <i class="fas fa-moon"></i>
  </button>

  <div class="container">
    <div class="header">
      <h1>我的导航站</h1>
      <p>常用网站收藏，快速访问</p>
    </div>

    <div class="search-container">
      <input type="text" class="search-input" id="searchInput" placeholder="搜索网站...">
      <i class="fas fa-search search-icon"></i>
    </div>

    <div class="categories" id="categories">
      <button class="category-tab active" data-category="all">全部</button>
    </div>

    <div class="links-grid" id="linksGrid">
      <div class="loading">
        <i class="fas fa-spinner"></i>
        <p>加载中...</p>
      </div>
    </div>

    <div class="footer">
      <p>© 2026 我的导航站</p>
    </div>
  </div>

  <script>
    // API配置（从环境变量读取）
    const API_BASE = API_BASE_URL || 'https://nav-database.zengwein6.workers.dev';

    // 状态
    let currentCategory = 'all';
    let allLinks = [];
    let categories = [];

    // DOM元素
    const themeToggle = document.getElementById('themeToggle');
    const searchInput = document.getElementById('searchInput');
    const categoriesContainer = document.getElementById('categories');
    const linksGrid = document.getElementById('linksGrid');

    // 初始化主题
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }

    // 更新主题图标
    function updateThemeIcon(theme) {
      const icon = themeToggle.querySelector('i');
      icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }

    // 切换主题
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });

    // 获取分类
    async function fetchCategories() {
      try {
        const response = await fetch(`${API_BASE}/api/categories`);
        const data = await response.json();
        categories = data;
        renderCategories();
      } catch (error) {
        console.error('获取分类失败:', error);
      }
    }

    // 渲染分类标签
    function renderCategories() {
      categoriesContainer.innerHTML = '<button class="category-tab active" data-category="all">全部</button>';
      categories.forEach(category => {
        const btn = document.createElement('button');
        btn.className = 'category-tab';
        btn.dataset.category = category.category;
        btn.textContent = category.category;
        btn.addEventListener('click', () => selectCategory(category.category));
        categoriesContainer.appendChild(btn);
      });
    }

    // 选择分类
    function selectCategory(category) {
      currentCategory = category;
      document.querySelectorAll('.category-tab').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.category === category);
      });
      renderLinks();
    }

    // 获取链接
    async function fetchLinks() {
      console.log('开始获取链接, API_BASE:', API_BASE);
      try {
        let url = `${API_BASE}/api/links`;
        if (currentCategory !== 'all') {
          url += `/${currentCategory}`;
        }
        console.log('请求URL:', url);
        const response = await fetch(url);
        console.log('响应状态:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const data = await response.json();
        console.log('获取到的数据:', data);
        allLinks = data;
        console.log('allLinks长度:', allLinks.length);
        renderLinks();
      } catch (error) {
        console.error('获取链接失败:', error);
        linksGrid.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-circle"></i>
            <p>加载失败: ${error.message}</p>
          </div>
        `;
      }
    }

    // 渲染链接
    function renderLinks() {
      const searchTerm = searchInput.value.toLowerCase();

      let filteredLinks = allLinks;
      if (currentCategory !== 'all') {
        filteredLinks = filteredLinks.filter(link => link.category === currentCategory);
      }

      if (searchTerm) {
        filteredLinks = filteredLinks.filter(link =>
          link.name.toLowerCase().includes(searchTerm) ||
          link.url.toLowerCase().includes(searchTerm) ||
          (link.description && link.description.toLowerCase().includes(searchTerm))
        );
      }

      if (filteredLinks.length === 0) {
        linksGrid.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-folder-open"></i>
            <p>暂无链接</p>
          </div>
        `;
        return;
      }

      linksGrid.innerHTML = filteredLinks.map(link => {
        const icon = link.icon || 'fa-globe';
        return `
          <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="link-card">
            <div class="link-icon">
              <i class="fab ${icon}"></i>
            </div>
            <div class="link-name">${link.name}</div>
            <div class="link-url">${link.url}</div>
            <div class="link-description">${link.description || ''}</div>
          </a>
        `;
      }).join('');
    }

    // 搜索功能
    searchInput.addEventListener('input', renderLinks);

    // 初始化
    initTheme();
    fetchCategories();
    fetchLinks();
  </script>
</body>
</html>
